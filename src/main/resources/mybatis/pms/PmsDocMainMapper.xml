<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PmsDocMainMapper">
  <resultMap id="BaseResultMap" type="com.fh.entity.amsmodel.PmsDocMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    <id column="PFILE_ID" jdbcType="CHAR" property="pfileId" />
    <result column="P_ID" jdbcType="CHAR" property="pId" />
    <result column="pms_PFILE_ID" jdbcType="CHAR" property="pmsPfileId" />
    <result column="PFILE_NUM" jdbcType="NVARCHAR" property="pfileNum" />
    <result column="PFILE_NAME" jdbcType="NVARCHAR" property="pfileName" />
    <result column="PFILE_CREATIME" jdbcType="TIMESTAMP" property="pfileCreatime" />
    <result column="PFILE_PAGES" jdbcType="INTEGER" property="pfilePages" />
    <result column="PFILE_REMARK" jdbcType="NVARCHAR" property="pfileRemark" />
    <result column="PFILE_LOADTIME" jdbcType="TIMESTAMP" property="pfileLoadtime" />
    <result column="EXISTORNOT" jdbcType="INTEGER" property="existornot" />
    <result column="RECEIVE_HOW" jdbcType="NVARCHAR" property="receiveHow" />
    <result column="RECEIVE_DATE" jdbcType="TIMESTAMP" property="receiveDate" />
    <result column="REMOVE_HOW" jdbcType="NVARCHAR" property="removeHow" />
    <result column="REMOVE_DATE" jdbcType="TIMESTAMP" property="removeDate" />
    <result column="OTHER" jdbcType="NVARCHAR" property="other" />
    <result column="PFILE_TYPE_ID" jdbcType="CHAR" property="pfileTypeId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    PFILE_ID, P_ID, pms_PFILE_ID, PFILE_NUM, PFILE_NAME, PFILE_CREATIME, PFILE_PAGES, 
    PFILE_REMARK, PFILE_LOADTIME, EXISTORNOT, RECEIVE_HOW, RECEIVE_DATE, REMOVE_HOW, 
    REMOVE_DATE, OTHER,PFILE_TYPE_ID
  </sql>
   <!-- 根据IDs查询档案盒信息 -->
   	<select id="findFileByIds" resultType="pd" parameterType="String">
		SELECT 
		<include refid="Base_Column_List" />
		 from
		pms_docmain
		where pfile_id
		 in
		<foreach item="item" index="index" collection="array" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</select>
	 <insert id="insertborrowFile" parameterType="pd">
    insert into pms_borrowcontent (borrowid, pmsid)
    values (#{borrowid,jdbcType=CHAR}, #{pfile_id,jdbcType=CHAR}
      )
  </insert>
      <insert id="insertborrow" parameterType="pd">
    insert into fms_borrow (ID, NAME, DESCRIBLE, 
      STARTTIME, ENDTIME, ISVALID,BORROW_USER_ID
      )
    values (#{borrowid,jdbcType=CHAR}, #{name,jdbcType=NVARCHAR}, #{describle,jdbcType=NVARCHAR}, 
      #{starttime}, #{endtime}, 
       #{isvalid,jdbcType=INTEGER}, #{borrow_user_id,jdbcType=NVARCHAR}
      )
  </insert>
  <!-- 查询所有借阅信息 -->
      <select id="listAllPlendInfoslistPage"  parameterType="pd" resultType="pd">
     <if test="pd.isValid==2 or pd.isValid==''or pd.isValid==null"><!-- 全部 -->
     SELECT pmsd.*,pp.NAME as PNAME FROM  pms_docmain pmsd, pms_pinformation pp where pmsd.pms_PFILE_ID='0' and pmsd.P_ID=pp.P_ID
		</if>
		<if test="pd.isValid==0"><!-- 借出 -->
		     SELECT DISTINCT pmsd.*,pp.NAME as PNAME,fb.*,su.NAME as BORROW_USER FROM sys_user su,  pms_docmain pmsd, pms_pinformation pp, pms_borrowcontent pb,fms_borrow fb
 where pmsd.pms_PFILE_ID='0' and pmsd.P_ID=pp.P_ID AND pmsd.PFILE_ID=pb.pmsid AND pb.borrowid=fb.ID AND fb.NOWENDTIME is NULL AND su.USER_ID=fb.BORROW_USER_ID
		</if>
		 <if test="pd.isValid==1"><!-- 未借出 -->
		  SELECT DISTINCT pmsd.*,pp.NAME as PNAME from pms_docmain pmsd ,pms_pinformation PP WHERE pmsd.P_ID=pp.P_ID and pmsd.pms_PFILE_ID='0' and pmsd.PFILE_ID  not in(SELECT DISTINCT d.PFILE_ID FROM  pms_docmain d, pms_pinformation p, pms_borrowcontent pb,fms_borrow fb
 where d.pms_PFILE_ID='0' and d.P_ID=p.P_ID AND d.PFILE_ID=pb.pmsid AND pb.borrowid=fb.ID AND fb.NOWENDTIME is NULL)
		 
		</if>
		<if test="pd.keywords!= null and pd.keywords != ''"><!-- 关键词检索 -->
			and
			(
			pmsd.PFILE_NAME LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			pmsd.PFILE_NUM LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			pp.NAME LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')	
			)
		</if>
     </select>
     <!-- 查询历史借阅信息 -->
      <select id="listAllPlendInfosByIdlistPage"  parameterType="pd" resultType="pd">
		select fb.NAME,fb.DESCRIBLE,fb.STARTTIME,fb.NOWENDTIME,su.NAME as BORROW_USER,
		pp.NAME as RETURN_USER from  fms_borrow fb  LEFT JOIN sys_user su on 
		su.USER_ID=fb.BORROW_USER_ID LEFT JOIN pms_pinformation pp on 
		pp.USER_ID=fb.RETURN_USER_ID LEFT JOIN pms_borrowcontent pb on
		 pb.borrowid=fb.ID where pb.pmsid= #{pd.PFILE_ID,jdbcType=CHAR}
     </select>
  <!--   进入页面默认显示的人事档案信息 -->
   <select id="listPFilesDefaultlistPage" parameterType="pd" resultType="pd">
    SELECT d.* ,p.NAME,t.PFILE_TYPE_NAME FROM pms_docmain d ,pms_pinformation p ,pms_pfiletype t WHERE 
   d.P_ID=p.P_ID AND p.P_ID=(SELECT TOP 1 P_ID FROM pms_docmain ORDER BY P_ID)
   AND d.pms_PFILE_ID!='0' AND d.PFILE_TYPE_ID=t.PFILE_TYPE_ID 
   </select>
<!--   通过user_id查询已有人事档案信息 -->
   <select id="listPFilesByUserIdlistPage" parameterType="pd" resultType="pd">
   SELECT d.* ,p.NAME,t.PFILE_TYPE_NAME FROM pms_docmain d ,pms_pinformation p ,pms_pfiletype t WHERE 
   d.P_ID=p.P_ID AND p.USER_ID=#{pd.USER_ID,jdbcType=CHAR}
   AND d.pms_PFILE_ID!='0' AND d.PFILE_TYPE_ID=t.PFILE_TYPE_ID
   </select>
     <!--   默认人事档案大盒子信息 -->
   <select id="getDefaultFileBox" parameterType="pd" resultType="pd">
   SELECT d.* ,p.NAME FROM pms_docmain d ,pms_pinformation p  WHERE 
   d.P_ID=p.P_ID AND p.P_ID=(SELECT TOP 1 P_ID FROM pms_docmain ORDER BY P_ID)
   AND d.pms_PFILE_ID='0' 
   </select>
   <!--   通过user_id查询大盒子信息 -->
   <select id="getFileBoxByUserId" parameterType="pd" resultType="pd">
   SELECT d.* ,p.NAME FROM pms_docmain d ,pms_pinformation p  WHERE 
   d.P_ID=p.P_ID AND p.USER_ID=#{USER_ID,jdbcType=CHAR}
   AND d.pms_PFILE_ID='0' 
   </select>
    <!--   查询默认人员信息信息 -->
   <select id="selectPinfoByDefault" parameterType="pd" resultType="pd">
   SELECT p.* FROM pms_pinformation p  WHERE  p.P_ID=(SELECT TOP 1 P_ID FROM pms_docmain ORDER BY P_ID)
   </select>
   <!--   通过user_id查询人员信息信息 -->
   <select id="selectPinfoByUserId" parameterType="pd" resultType="pd">
   SELECT p.* FROM pms_pinformation p  WHERE  p.USER_ID=#{USER_ID,jdbcType=CHAR}
   </select>
     <!--   查询档案类型 -->
   <select id="listAllFileTypes" parameterType="pd" resultType="pd">
   SELECT * from pms_pfiletype
   </select>
   
  <select id="selectByPrimaryKey" parameterType="pd" resultType="pd">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    select 
    d.*,t.PFILE_TYPE_NAME
    from pms_docmain d,pms_pfiletype t 
    where d.PFILE_ID = #{pfileId,jdbcType=CHAR} and d.PFILE_TYPE_ID=t.PFILE_TYPE_ID
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    delete from pms_docmain
    where PFILE_ID = #{pfileId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.fh.entity.amsmodel.PmsDocMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    insert into pms_docmain (PFILE_ID, P_ID, pms_PFILE_ID, 
      PFILE_NUM, PFILE_NAME, PFILE_CREATIME, 
      PFILE_PAGES, PFILE_REMARK, PFILE_LOADTIME, 
      EXISTORNOT, RECEIVE_HOW, RECEIVE_DATE, 
      REMOVE_HOW, REMOVE_DATE, OTHER,PFILE_TYPE_ID
      )
    values (#{pfileId,jdbcType=CHAR}, #{pId,jdbcType=CHAR}, #{pmsPfileId,jdbcType=CHAR}, 
      #{pfileNum,jdbcType=NVARCHAR}, #{pfileName,jdbcType=NVARCHAR}, #{pfileCreatime,jdbcType=TIMESTAMP}, 
      #{pfilePages,jdbcType=INTEGER}, #{pfileRemark,jdbcType=NVARCHAR}, #{pfileLoadtime,jdbcType=TIMESTAMP}, 
      #{existornot,jdbcType=INTEGER}, #{receiveHow,jdbcType=NVARCHAR}, #{receiveDate,jdbcType=TIMESTAMP}, 
      #{removeHow,jdbcType=NVARCHAR}, #{removeDate,jdbcType=TIMESTAMP}, #{other,jdbcType=NVARCHAR}, #{pfileTypeId,jdbcType=CHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.fh.entity.amsmodel.PmsDocMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    insert into pms_docmain
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="pfileId != null">
        PFILE_ID,
      </if>
      <if test="pId != null">
        P_ID,
      </if>
      <if test="pmsPfileId != null">
        pms_PFILE_ID,
      </if>
      <if test="pfileNum != null">
        PFILE_NUM,
      </if>
      <if test="pfileName != null">
        PFILE_NAME,
      </if>
      <if test="pfileCreatime != null">
        PFILE_CREATIME,
      </if>
      <if test="pfilePages != null">
        PFILE_PAGES,
      </if>
      <if test="pfileRemark != null">
        PFILE_REMARK,
      </if>
      <if test="pfileLoadtime != null">
        PFILE_LOADTIME,
      </if>
      <if test="existornot != null">
        EXISTORNOT,
      </if>
      <if test="receiveHow != null">
        RECEIVE_HOW,
      </if>
      <if test="receiveDate != null">
        RECEIVE_DATE,
      </if>
      <if test="removeHow != null">
        REMOVE_HOW,
      </if>
      <if test="removeDate != null">
        REMOVE_DATE,
      </if>
      <if test="other != null">
        OTHER,
      </if>
      <if test="pfileTypeId != null">
        PFILE_TYPE_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="pfileId != null">
        #{pfileId,jdbcType=CHAR},
      </if>
      <if test="pId != null">
        #{pId,jdbcType=CHAR},
      </if>
      <if test="pmsPfileId != null">
        #{pmsPfileId,jdbcType=CHAR},
      </if>
      <if test="pfileNum != null">
        #{pfileNum,jdbcType=NVARCHAR},
      </if>
      <if test="pfileName != null">
        #{pfileName,jdbcType=NVARCHAR},
      </if>
      <if test="pfileCreatime != null">
        #{pfileCreatime,jdbcType=TIMESTAMP},
      </if>
      <if test="pfilePages != null">
        #{pfilePages,jdbcType=INTEGER},
      </if>
      <if test="pfileRemark != null">
        #{pfileRemark,jdbcType=NVARCHAR},
      </if>
      <if test="pfileLoadtime != null">
        #{pfileLoadtime,jdbcType=TIMESTAMP},
      </if>
      <if test="existornot != null">
        #{existornot,jdbcType=INTEGER},
      </if>
      <if test="receiveHow != null">
        #{receiveHow,jdbcType=NVARCHAR},
      </if>
      <if test="receiveDate != null">
        #{receiveDate,jdbcType=TIMESTAMP},
      </if>
      <if test="removeHow != null">
        #{removeHow,jdbcType=NVARCHAR},
      </if>
      <if test="removeDate != null">
        #{removeDate,jdbcType=TIMESTAMP},
      </if>
      <if test="other != null">
        #{other,jdbcType=NVARCHAR},
      </if>
       <if test="pfileTypeId != null">
        #{pfileTypeId,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.fh.entity.amsmodel.PmsDocMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    update pms_docmain
    <set>
      <if test="pId != null">
        P_ID = #{pId,jdbcType=CHAR},
      </if>
      <if test="pmsPfileId != null">
        pms_PFILE_ID = #{pmsPfileId,jdbcType=CHAR},
      </if>
      <if test="pfileNum != null">
        PFILE_NUM = #{pfileNum,jdbcType=NVARCHAR},
      </if>
      <if test="pfileName != null">
        PFILE_NAME = #{pfileName,jdbcType=NVARCHAR},
      </if>
      <if test="pfileCreatime != null">
        PFILE_CREATIME = #{pfileCreatime,jdbcType=TIMESTAMP},
      </if>
      <if test="pfilePages != null">
        PFILE_PAGES = #{pfilePages,jdbcType=INTEGER},
      </if>
      <if test="pfileRemark != null">
        PFILE_REMARK = #{pfileRemark,jdbcType=NVARCHAR},
      </if>
      <if test="pfileLoadtime != null">
        PFILE_LOADTIME = #{pfileLoadtime,jdbcType=TIMESTAMP},
      </if>
      <if test="existornot != null">
        EXISTORNOT = #{existornot,jdbcType=INTEGER},
      </if>
      <if test="receiveHow != null">
        RECEIVE_HOW = #{receiveHow,jdbcType=NVARCHAR},
      </if>
      <if test="receiveDate != null">
        RECEIVE_DATE = #{receiveDate,jdbcType=TIMESTAMP},
      </if>
      <if test="removeHow != null">
        REMOVE_HOW = #{removeHow,jdbcType=NVARCHAR},
      </if>
      <if test="removeDate != null">
        REMOVE_DATE = #{removeDate,jdbcType=TIMESTAMP},
      </if>
      <if test="other != null">
        OTHER = #{other,jdbcType=NVARCHAR},
      </if>
      <if test="pfileTypeId != null">
        PFILE_TYPE_ID = #{pfileTypeId,jdbcType=CHAR},
      </if>
    </set>
    where PFILE_ID = #{pfileId,jdbcType=CHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.fh.entity.amsmodel.PmsDocMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    update pms_docmain
    set P_ID = #{pId,jdbcType=CHAR},
      pms_PFILE_ID = #{pmsPfileId,jdbcType=CHAR},
      PFILE_NUM = #{pfileNum,jdbcType=NVARCHAR},
      PFILE_NAME = #{pfileName,jdbcType=NVARCHAR},
      PFILE_CREATIME = #{pfileCreatime,jdbcType=TIMESTAMP},
      PFILE_PAGES = #{pfilePages,jdbcType=INTEGER},
      PFILE_REMARK = #{pfileRemark,jdbcType=NVARCHAR},
      PFILE_LOADTIME = #{pfileLoadtime,jdbcType=TIMESTAMP},
      EXISTORNOT = #{existornot,jdbcType=INTEGER},
      RECEIVE_HOW = #{receiveHow,jdbcType=NVARCHAR},
      RECEIVE_DATE = #{receiveDate,jdbcType=TIMESTAMP},
      REMOVE_HOW = #{removeHow,jdbcType=NVARCHAR},
      REMOVE_DATE = #{removeDate,jdbcType=TIMESTAMP},
      OTHER = #{other,jdbcType=NVARCHAR},
      PFILE_TYPE_ID = #{pfileTypeId,jdbcType=CHAR}
    where PFILE_ID = #{pfileId,jdbcType=CHAR}
  </update>
</mapper>