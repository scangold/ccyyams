<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PmsPInformationMapper">
  <resultMap id="BaseResultMap" type="PmsPInformation">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    <id column="P_ID" jdbcType="CHAR" property="pId" />
    <result column="USER_ID" jdbcType="CHAR" property="userId" />
    <result column="NAME" jdbcType="NVARCHAR" property="name" />
    <result column="SEX" jdbcType="NVARCHAR" property="sex" />
    <result column="NATION" jdbcType="NVARCHAR" property="nation" />
    <result column="ORIGINPLACE" jdbcType="NVARCHAR" property="originplace" />
    <result column="POLITICALID" jdbcType="NVARCHAR" property="politicalid" />
    <result column="JOINPARTYDAY" jdbcType="TIMESTAMP" property="joinpartyday" />
    <result column="JOINLEAGUEDAY" jdbcType="TIMESTAMP" property="joinleagueday" />
    <result column="MARITALSTATUS" jdbcType="NVARCHAR" property="maritalstatus" />
    <result column="DEGREE" jdbcType="NVARCHAR" property="degree" />
    <result column="MAJOR" jdbcType="NVARCHAR" property="major" />
    <result column="SCHOOL" jdbcType="NVARCHAR" property="school" />
    <result column="HUKOU" jdbcType="NVARCHAR" property="hukou" />
    <result column="IDNUMBER" jdbcType="CHAR" property="idnumber" />
    <result column="TELEPHONE" jdbcType="NVARCHAR" property="telephone" />
    <result column="CREATIME" jdbcType="TIMESTAMP" property="creatime" />
    <result column="REFRESHTIME" jdbcType="TIMESTAMP" property="refreshtime" />
    <result column="HIRED" jdbcType="BIT" property="hired" />
    <result column="PPOST" jdbcType="NVARCHAR" property="ppost" />
    <result column="PTITLE" jdbcType="NVARCHAR" property="ptitle" />
     <result column="PHOTOPATH" jdbcType="NVARCHAR" property="photopath" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    P_ID, USER_ID, NAME, SEX, NATION, ORIGINPLACE, POLITICALID, JOINPARTYDAY, JOINLEAGUEDAY, 
    MARITALSTATUS, DEGREE, MAJOR, SCHOOL, HUKOU, IDNUMBER, TELEPHONE, CREATIME, REFRESHTIME, 
    HIRED, PPOST, PTITLE
  </sql>
  <select id="listAllPerson" parameterType="pd" resultMap="BaseResultMap">
		select *
		from 
		pms_pinformation
		where 1=1
	</select>
  <!-- 查询所有人事信息 -->
      <select id="listAllPerslistPage"  parameterType="pd" resultType="pd">
     <![CDATA[select DISTINCT
		u.*,w.NAME as DEPARTMENTNAME
		from pms_pinformation u,sys_user v,oa_department w,pms_certificateandhonor c,ams_project ap
		where u.USER_ID=v.USER_ID and v.DEPARTMENT_ID=W.DEPARTMENT_ID]]>
		<if test="pd.keywords!= null and pd.keywords != ''"><!-- 关键词检索 -->
			and
			(
			u.NAME LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			u.SEX LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			u.NATION LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			u.ORIGINPLACE
			LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			w.NAME
			LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			u.POLITICALID LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			u.DEGREE LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')		
			or
			u.TELEPHONE LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')			
			)
			
		</if>
		<if test="pd.isValid!= null and pd.isValid != ''"><!-- 是否在职检索 -->
		and u.HIRED= #{pd.isValid,jdbcType=BIT}
		</if>
		<if test="pd.sex!= null and pd.sex != ''"><!-- 性别检索 -->
		and u.SEX= #{pd.sex,jdbcType=NVARCHAR}
		</if>
		<if test="pd.politicalid!= null and pd.politicalid != ''"><!-- 政治面貌检索 -->
		and u.POLITICALID= #{pd.politicalid,jdbcType=NVARCHAR}
		</if>
		<if test="pd.honor!= null and pd.honor != ''"><!-- 获奖荣誉名称检索 -->
		and c.P_ID=u.P_ID and c.PRYZS_NAME LIKE CONCAT(CONCAT('%', #{pd.honor}),'%')
		</if>
		<if test="pd.minAge!= null and pd.minAge != ''"><!-- 最小年纪检索 -->
		<![CDATA[and ( SELECT year(getdate())-substring(u.IDNUMBER,7,4))]]>>#{pd.minAge,jdbcType=NVARCHAR}
		</if>
       <if test="pd.maxAge!= null and pd.maxAge != ''"><!-- 最大年纪检索 -->
		<![CDATA[and ( SELECT year(getdate())-substring(u.IDNUMBER,7,4))]]><![CDATA[<]]>#{pd.maxAge,jdbcType=NVARCHAR}
		</if> 
     <if test="pd.department_id!= null and pd.department_id != ''"><!-- 所在部门检索 -->
		and v.DEPARTMENT_ID= #{pd.department_id,jdbcType=NVARCHAR}
		</if>
		<if test="pd.degree!= null and pd.degree != ''"><!-- 最高学历检索 -->
		and u.DEGREE= #{pd.degree,jdbcType=NVARCHAR}
		</if>
		<if test="pd.ptitle!= null and pd.ptitle != ''"><!--职称检索 -->
		and u.PTITLE= #{pd.ptitle,jdbcType=NVARCHAR}
		</if>
		<if test="pd.telephone!= null and pd.telephone != ''"><!--电话号码检索 -->
		and u.TELEPHONE LIKE CONCAT(CONCAT('%', #{pd.telephone}),'%')
		</if>
		<if test="pd.hukou!= null and pd.hukou != ''"><!--户口所在地检索 -->
		and u.HUKOU LIKE CONCAT(CONCAT('%', #{pd.hukou}),'%')
		</if>
		<if test="pd.originplace!= null and pd.originplace != ''"><!--籍贯检索 -->
		and u.ORIGINPLACE LIKE CONCAT(CONCAT('%', #{pd.originplace}),'%')
		</if>
		<if test="pd.maritalstatus!= null and pd.maritalstatus != ''"><!--婚姻状态检索 -->
		and u.MARITALSTATUS= #{pd.maritalstatus,jdbcType=NVARCHAR}
		</if>
		<if test="pd.major!= null and pd.major != ''"><!--专业检索 -->
		and u.MAJOR LIKE CONCAT(CONCAT('%', #{pd.major}),'%')
		</if>
		<if test="pd.school!= null and pd.school != ''"><!--毕业院校 -->
		and u.SCHOOL LIKE CONCAT(CONCAT('%', #{pd.school}),'%')
		</if>
		<if test="pd.prjName!= null and pd.prjName != ''"><!-- 所做项目检索 -->
		and u.NAME=ap.PRJ_LEADER and ap.PRJ_NAME LIKE CONCAT(CONCAT('%', #{pd.prjName}),'%')
		</if>
     </select>
  <!-- 根据第一层department_id查询所有人事信息 -->
     <select id="listOnePerslistPage"   parameterType="pd" resultType="pd">
     select p.*,w.NAME as DEPARTMENTNAME from pms_pinformation p,sys_user u,oa_department w where  p.USER_ID=u.USER_ID and u.DEPARTMENT_ID=W.DEPARTMENT_ID and u.DEPARTMENT_ID in (SELECT  DEPARTMENT_ID from oa_department WHERE PARENT_ID=#{pd.DEPARTMENT_ID,jdbcType=NVARCHAR})
        <if test="pd.keywords!= null and pd.keywords != ''"><!-- 关键词检索 -->
			and
			(
			p.NAME LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.SEX LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.NATION LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.ORIGINPLACE
			LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			w.NAME
			LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.POLITICALID LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.DEGREE LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')		
			or
			p.TELEPHONE LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')			
			)
		</if>
        <if test="pd.isValid!= null and pd.isValid != ''"><!-- 是否在职检索 -->
		and p.HIRED= #{pd.isValid,jdbcType=BIT}
		</if>
     </select> 
      <!-- 根据第二层department_id查询所有人事信息 -->
     <select id="listTwoPerslistPage"   parameterType="pd" resultType="pd">
      SELECT p.* ,w.NAME as DEPARTMENTNAME from pms_pinformation p,sys_user u,oa_department w where  p.USER_ID=u.USER_ID and u.DEPARTMENT_ID=W.DEPARTMENT_ID and u.DEPARTMENT_ID=#{pd.DEPARTMENT_ID,jdbcType=NVARCHAR} 
       <if test="pd.keywords!= null and pd.keywords != ''"><!-- 关键词检索 -->
			and
			(
			p.NAME LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.SEX LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.NATION LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.ORIGINPLACE
			LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			w.NAME
			LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.POLITICALID LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			p.DEGREE LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')		
			or
			p.TELEPHONE LIKE
			CONCAT(CONCAT('%', #{pd.keywords}),'%')			
			)
		</if>
       <if test="pd.isValid!= null and pd.isValid != ''"><!-- 是否在职检索 -->
		and p.HIRED= #{pd.isValid,jdbcType=BIT}
		</if>
       </select> 
       <select id="getCountByDegree"   parameterType="pd" resultType="pd">
       SELECT DEGREE,count(DEGREE) as count from pms_pinformation GROUP BY DEGREE
       </select>
       <select id="getCountByPtitle"   parameterType="pd" resultType="pd">
      SELECT PTITLE,count(PTITLE) as count from pms_pinformation GROUP BY PTITLE
       </select>
       <select id="getCountByDepartment"   parameterType="pd" resultType="pd">
      select od.NAME as department,count(od.NAME) as count from pms_pinformation pp,sys_user su,oa_department od where su.DEPARTMENT_ID=od.DEPARTMENT_ID and pp.USER_ID=su.USER_ID
group by od.NAME
       </select>
     <!-- 增加人事信息 -->
<!-- 	 <insert id="insertP" parameterType="PmsPInformation">
    
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
   
    insert into pms_pinformation (P_ID, USER_ID, NAME, 
      SEX, NATION, ORIGINPLACE, 
      POLITICALID, JOINPARTYDAY, JOINLEAGUEDAY, 
      MARITALSTATUS, DEGREE, MAJOR, 
      SCHOOL, HUKOU, IDNUMBER, 
      TELEPHONE,  REFRESHTIME, 
      HIRED, PPOST, PTITLE)
    values (#{P_ID,jdbcType=CHAR}, #{USER_ID,jdbcType=CHAR}, #{NAME,jdbcType=NVARCHAR}, 
      #{SEX,jdbcType=NVARCHAR}, #{NATION,jdbcType=NVARCHAR}, #{ORIGINPLACE,jdbcType=NVARCHAR}, 
      #{POLITICALID,jdbcType=NVARCHAR}, #{JOINPARTYDAY,jdbcType=TIMESTAMP}, #{JOINLEAGUEDAY,jdbcType=TIMESTAMP}, 
      #{MARITALSTATUS,jdbcType=NVARCHAR}, #{DEGREE,jdbcType=NVARCHAR}, #{MAJOR,jdbcType=NVARCHAR}, 
      #{SCHOOL,jdbcType=NVARCHAR}, #{HUKOU,jdbcType=NVARCHAR}, #{IDNUMBER,jdbcType=CHAR}, 
      #{PHONE,jdbcType=NVARCHAR},  #{REFRESHTIME,jdbcType=TIMESTAMP}, 
      #{HIRED,jdbcType=BIT}, #{PPOST,jdbcType=NVARCHAR}, #{PTITLE,jdbcType=NVARCHAR})
  </insert> -->
  	 <insert id="insertP" parameterType="PmsPInformation">
    insert into pms_pinformation
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="P_ID != null">
        P_ID,
      </if>
      <if test="USER_ID != null">
        USER_ID,
      </if>
      <if test="NAME != null">
        NAME,
      </if>
      <if test="SEX != null">
        SEX,
      </if>
      <if test="NATION != null">
        NATION,
      </if>
      <if test="ORIGINPLACE != null">
        ORIGINPLACE,
      </if>
      <if test="POLITICALID != null">
        POLITICALID,
      </if>
      <if test="JOINPARTYDAY != null">
        JOINPARTYDAY,
      </if>
      <if test="JOINLEAGUEDAY != null">
        JOINLEAGUEDAY,
      </if>
      <if test="MARITALSTATUS != null">
        MARITALSTATUS,
      </if>
      <if test="DEGREE != null">
        DEGREE,
      </if>
      <if test="MAJOR != null">
        MAJOR,
      </if>
      <if test="SCHOOL != null">
        SCHOOL,
      </if>
      <if test="HUKOU != null">
        HUKOU,
      </if>
      <if test="IDNUMBER != null">
        IDNUMBER,
      </if>
      <if test="PHONE != null">
        TELEPHONE,
      </if>
      <if test="CREATIME != null">
        CREATIME,
      </if>
      <if test="REFRESHTIME != null">
        REFRESHTIME,
      </if>
      <if test="HIRED != null">
        HIRED,
      </if>
      <if test="PPOST != null">
        PPOST,
      </if>
      <if test="PTITLE != null">
        PTITLE,
      </if>
       <if test="PHOTOPATH != null">
        PHOTOPATH,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="P_ID != null">
        #{P_ID,jdbcType=CHAR},
      </if>
      <if test="USER_ID != null">
        #{USER_ID,jdbcType=CHAR},
      </if>
      <if test="NAME != null">
        #{NAME,jdbcType=NVARCHAR},
      </if>
      <if test="SEX != null">
        #{SEX,jdbcType=NVARCHAR},
      </if>
      <if test="NATION != null">
        #{NATION,jdbcType=NVARCHAR},
      </if>
      <if test="ORIGINPLACE != null">
        #{ORIGINPLACE,jdbcType=NVARCHAR},
      </if>
      <if test="POLITICALID != null">
        #{POLITICALID,jdbcType=NVARCHAR},
      </if>
      <if test="JOINPARTYDAY != null">
        #{JOINPARTYDAY,jdbcType=TIMESTAMP},
      </if>
      <if test="JOINLEAGUEDAY != null">
        #{JOINLEAGUEDAY,jdbcType=TIMESTAMP},
      </if>
      <if test="MARITALSTATUS != null">
        #{MARITALSTATUS,jdbcType=NVARCHAR},
      </if>
      <if test="DEGREE != null">
        #{DEGREE,jdbcType=NVARCHAR},
      </if>
      <if test="MAJOR != null">
        #{MAJOR,jdbcType=NVARCHAR},
      </if>
      <if test="SCHOOL != null">
        #{SCHOOL,jdbcType=NVARCHAR},
      </if>
      <if test="HUKOU != null">
        #{HUKOU,jdbcType=NVARCHAR},
      </if>
      <if test="IDNUMBER != null">
        #{IDNUMBER,jdbcType=CHAR},
      </if>
      <if test="PHONE != null">
        #{PHONE,jdbcType=NVARCHAR},
      </if>
      <if test="CREATIME != null">
        #{CREATIME,jdbcType=TIMESTAMP},
      </if>
      <if test="REFRESHTIME != null">
        #{REFRESHTIME,jdbcType=TIMESTAMP},
      </if>
      <if test="HIRED != null">
        #{HIRED,jdbcType=BIT},
      </if>
      <if test="PPOST != null">
        #{PPOST,jdbcType=NVARCHAR},
      </if>
      <if test="PTITLE != null">
        #{PTITLE,jdbcType=NVARCHAR},
      </if>
       <if test="PHOTOPATH != null">
        #{PHOTOPATH,jdbcType=NVARCHAR},
      </if>
    </trim>
  </insert>
  <!-- 逻辑删除人事信息 -->
  <update id="deleteSelectedPer"   parameterType="pd">
   UPDATE pms_pinformation SET HIRED =0,REFRESHTIME=#{REFRESHTIME} WHERE USER_ID = #{USER_ID}
  </update>
  <update id="deleteSelectedUser"   parameterType="pd">
   UPDATE sys_user SET IFHIRED=0 WHERE USER_ID = #{USER_ID}
  </update>
  
   <!-- 更新人事信息 -->
  <update id="editSelectedPer"   parameterType="pd">
  
  <!--  UPDATE pms_pinformation SET NAME = #{NAME}, SEX = #{SEX},NATION=#{NATION},ORIGINPLACE=#{ORIGINPLACE},POLITICALID=#{POLITICALID},
   JOINPARTYDAY=#{JOINPARTYDAY},JOINLEAGUEDAY=#{JOINLEAGUEDAY},MARITALSTATUS=#{MARITALSTATUS},DEGREE=#{DEGREE},MAJOR=#{MAJOR},
   SCHOOL=#{SCHOOL},HUKOU=#{HUKOU},IDNUMBER=#{IDNUMBER},TELEPHONE=#{PHONE},HIRED=#{HIRED},PPOST=#{PPOST},PTITLE=#{PTITLE},REFRESHTIME=#{REFRESHTIME}
   WHERE USER_ID = #{USER_ID} -->
    UPDATE pms_pinformation
     <set>
      <if test="USER_ID != null">
        USER_ID = #{USER_ID,jdbcType=CHAR},
      </if>
      <if test="NAME != null">
        NAME = #{NAME,jdbcType=NVARCHAR},
      </if>
      <if test="SEX != null">
        SEX = #{SEX,jdbcType=NVARCHAR},
      </if>
      <if test="NATION != null">
        NATION = #{NATION,jdbcType=NVARCHAR},
      </if>
      <if test="ORIGINPLACE != null">
        ORIGINPLACE = #{ORIGINPLACE,jdbcType=NVARCHAR},
      </if>
      <if test="POLITICALID != null">
        POLITICALID = #{POLITICALID,jdbcType=NVARCHAR},
      </if>
      <if test="JOINPARTYDAY != null">
        JOINPARTYDAY = #{JOINPARTYDAY,jdbcType=TIMESTAMP},
      </if>
      <if test="JOINLEAGUEDAY != null">
        JOINLEAGUEDAY = #{JOINLEAGUEDAY,jdbcType=TIMESTAMP},
      </if>
      <if test="MARITALSTATUS != null">
        MARITALSTATUS = #{MARITALSTATUS,jdbcType=NVARCHAR},
      </if>
      <if test="DEGREE != null">
        DEGREE = #{DEGREE,jdbcType=NVARCHAR},
      </if>
      <if test="MAJOR != null">
        MAJOR = #{MAJOR,jdbcType=NVARCHAR},
      </if>
      <if test="SCHOOL != null">
        SCHOOL = #{SCHOOL,jdbcType=NVARCHAR},
      </if>
      <if test="HUKOU != null">
        HUKOU = #{HUKOU,jdbcType=NVARCHAR},
      </if>
      <if test="IDNUMBER != null">
        IDNUMBER = #{IDNUMBER,jdbcType=CHAR},
      </if>
      <if test="PHONE != null">
        TELEPHONE = #{PHONE,jdbcType=NVARCHAR},
      </if>
      <if test="CREATIME != null">
        CREATIME = #{CREATIME,jdbcType=TIMESTAMP},
      </if>
      <if test="REFRESHTIME != null">
        REFRESHTIME = #{REFRESHTIME,jdbcType=TIMESTAMP},
      </if>
      <if test="HIRED != null">
        HIRED = #{HIRED,jdbcType=BIT},
      </if>
      <if test="PPOST != null">
        PPOST = #{PPOST,jdbcType=NVARCHAR},
      </if>
      <if test="PPOST != null">
        PTITLE = #{PPOST,jdbcType=NVARCHAR},
      </if>
    </set>
    where USER_ID = #{USER_ID}
  </update>
   <update id="editSelectedUser"   parameterType="pd">
   UPDATE sys_user SET NAME = #{NAME}, DEPARTMENT_ID = #{DEPARTMENT_ID},PHONE=#{PHONE},EMAIL=#{EMAIL},BZ=#{BZ}
   WHERE USER_ID = #{USER_ID}
  </update>
  
  <!-- 查看个人人事信息 -->
  <select id="listSelectedPer"   parameterType="pd" resultType="pd">
    SELECT a.* ,b.* ,c.NAME AS DEPARTMENT_NAME FROM pms_pinformation a,sys_user b ,oa_department c 
    WHERE a.USER_ID=b.USER_ID and b.DEPARTMENT_ID=c.DEPARTMENT_ID and a.USER_ID=#{USER_ID,jdbcType=NVARCHAR}
  </select>
  
  <!-- 列出所有人事信息（树结构） -->
    <select id="listAllPersons"   parameterType="pd" resultType="pd">
with Dep as 
( 
    SELECT C.DEPARTMENT_ID,C.NAME,C.PARENT_ID ,0 as opened,0 AS iffiled  from pms_pinformation A,sys_user B,oa_department C WHERE A.USER_ID=B.USER_ID AND B.DEPARTMENT_ID=C.DEPARTMENT_ID AND A.HIRED=1 
    union all 
    select d.DEPARTMENT_ID,d.NAME,d.PARENT_ID,1 as opened,0 AS iffiled  from Dep dep
    inner join oa_department d on dep.PARENT_ID = d.DEPARTMENT_ID 
) 

select DISTINCT * from Dep UNION
select A.USER_ID,A.NAME,b.DEPARTMENT_ID,0 as opened,(SELECT COUNT(*) FROM pms_docmain D WHERE A.P_ID=D.P_ID AND D.pms_PFILE_ID='0') AS iffiled  from pms_pinformation A,sys_user B where A.USER_ID=B.USER_ID AND A.HIRED=1 
	
	</select>
<!--   <select id="listAllPersons"   parameterType="pd" resultType="pd">
			with Dep as 
( 
    SELECT  C.DEPARTMENT_ID,C.NAME,C.PARENT_ID ,0 as opened from pms_pinformation A,sys_user B,oa_department C WHERE A.USER_ID=B.USER_ID AND B.DEPARTMENT_ID=C.DEPARTMENT_ID AND A.HIRED=1 
    union all 
    select d.DEPARTMENT_ID,d.NAME,d.PARENT_ID,1 as opened from Dep dep
    inner join oa_department d on dep.PARENT_ID = d.DEPARTMENT_ID 
) 

select DISTINCT * from Dep UNION
SELECT  C.DEPARTMENT_ID,C.NAME,C.PARENT_ID,0 as opened from pms_pinformation A,sys_user B,oa_department C WHERE A.USER_ID=B.USER_ID AND B.DEPARTMENT_ID=C.DEPARTMENT_ID AND A.HIRED=1 UNION  
select A.USER_ID,A.NAME,b.DEPARTMENT_ID,0 as opened  from pms_pinformation A,sys_user B where A.USER_ID=B.USER_ID AND A.HIRED=1
	
	</select> -->
<!-- <select id="listAllPersons"   parameterType="pd" resultType="pd">
		with Dep as 
( 
    SELECT  C.DEPARTMENT_ID,C.NAME,C.PARENT_ID from pms_pinformation A,sys_user B,oa_department C WHERE A.USER_ID=B.USER_ID AND B.DEPARTMENT_ID=C.DEPARTMENT_ID
    union all 
    select d.DEPARTMENT_ID,d.NAME,d.PARENT_ID from Dep dep
    inner join oa_department d on dep.PARENT_ID = d.DEPARTMENT_ID 
) 

select DISTINCT * from Dep UNION
SELECT  C.DEPARTMENT_ID,C.NAME,C.PARENT_ID from pms_pinformation A,sys_user B,oa_department C WHERE A.USER_ID=B.USER_ID AND B.DEPARTMENT_ID=C.DEPARTMENT_ID UNION  
select A.USER_ID,A.NAME,b.DEPARTMENT_ID from pms_pinformation A,sys_user B where A.USER_ID=B.USER_ID 
	
	</select> -->
	
	
	
	
	
	
	
	
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from pms_pinformation
    where P_ID = #{pId,jdbcType=CHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    delete from pms_pinformation
    where P_ID = #{pId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="PmsPInformation">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    insert into pms_pinformation (P_ID, USER_ID, NAME, 
      SEX, NATION, ORIGINPLACE, 
      POLITICALID, JOINPARTYDAY, JOINLEAGUEDAY, 
      MARITALSTATUS, DEGREE, MAJOR, 
      SCHOOL, HUKOU, IDNUMBER, 
      TELEPHONE, REFRESHTIME, 
      HIRED, PPOST, PTITLE,PHOTOPATH)
    values (#{pId,jdbcType=CHAR}, #{userId,jdbcType=CHAR}, #{name,jdbcType=NVARCHAR}, 
      #{sex,jdbcType=NVARCHAR}, #{nation,jdbcType=NVARCHAR}, #{originplace,jdbcType=NVARCHAR}, 
      #{politicalid,jdbcType=NVARCHAR}, #{joinpartyday,jdbcType=TIMESTAMP}, #{joinleagueday,jdbcType=TIMESTAMP}, 
      #{maritalstatus,jdbcType=NVARCHAR}, #{degree,jdbcType=NVARCHAR}, #{major,jdbcType=NVARCHAR}, 
      #{school,jdbcType=NVARCHAR}, #{hukou,jdbcType=NVARCHAR}, #{idnumber,jdbcType=CHAR}, 
      #{telephone,jdbcType=NVARCHAR},#{refreshtime,jdbcType=TIMESTAMP}, 
      #{hired,jdbcType=BIT}, #{ppost,jdbcType=NVARCHAR}, #{ptitle,jdbcType=NVARCHAR}, #{photopath,jdbcType=NVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="PmsPInformation">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    insert into pms_pinformation
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="pId != null">
        P_ID,
      </if>
      <if test="userId != null">
        USER_ID,
      </if>
      <if test="name != null">
        NAME,
      </if>
      <if test="sex != null">
        SEX,
      </if>
      <if test="nation != null">
        NATION,
      </if>
      <if test="originplace != null">
        ORIGINPLACE,
      </if>
      <if test="politicalid != null">
        POLITICALID,
      </if>
      <if test="joinpartyday != null">
        JOINPARTYDAY,
      </if>
      <if test="joinleagueday != null">
        JOINLEAGUEDAY,
      </if>
      <if test="maritalstatus != null">
        MARITALSTATUS,
      </if>
      <if test="degree != null">
        DEGREE,
      </if>
      <if test="major != null">
        MAJOR,
      </if>
      <if test="school != null">
        SCHOOL,
      </if>
      <if test="hukou != null">
        HUKOU,
      </if>
      <if test="idnumber != null">
        IDNUMBER,
      </if>
      <if test="telephone != null">
        TELEPHONE,
      </if>
      <if test="creatime != null">
        CREATIME,
      </if>
      <if test="refreshtime != null">
        REFRESHTIME,
      </if>
      <if test="hired != null">
        HIRED,
      </if>
      <if test="ppost != null">
        PPOST,
      </if>
      <if test="ptitle != null">
        PTITLE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="pId != null">
        #{pId,jdbcType=CHAR},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=CHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=NVARCHAR},
      </if>
      <if test="sex != null">
        #{sex,jdbcType=NVARCHAR},
      </if>
      <if test="nation != null">
        #{nation,jdbcType=NVARCHAR},
      </if>
      <if test="originplace != null">
        #{originplace,jdbcType=NVARCHAR},
      </if>
      <if test="politicalid != null">
        #{politicalid,jdbcType=NVARCHAR},
      </if>
      <if test="joinpartyday != null">
        #{joinpartyday,jdbcType=TIMESTAMP},
      </if>
      <if test="joinleagueday != null">
        #{joinleagueday,jdbcType=TIMESTAMP},
      </if>
      <if test="maritalstatus != null">
        #{maritalstatus,jdbcType=NVARCHAR},
      </if>
      <if test="degree != null">
        #{degree,jdbcType=NVARCHAR},
      </if>
      <if test="major != null">
        #{major,jdbcType=NVARCHAR},
      </if>
      <if test="school != null">
        #{school,jdbcType=NVARCHAR},
      </if>
      <if test="hukou != null">
        #{hukou,jdbcType=NVARCHAR},
      </if>
      <if test="idnumber != null">
        #{idnumber,jdbcType=CHAR},
      </if>
      <if test="telephone != null">
        #{telephone,jdbcType=NVARCHAR},
      </if>
      <if test="creatime != null">
        #{creatime,jdbcType=TIMESTAMP},
      </if>
      <if test="refreshtime != null">
        #{refreshtime,jdbcType=TIMESTAMP},
      </if>
      <if test="hired != null">
        #{hired,jdbcType=BIT},
      </if>
      <if test="ppost != null">
        #{ppost,jdbcType=NVARCHAR},
      </if>
      <if test="ptitle != null">
        #{ptitle,jdbcType=NVARCHAR},
      </if>
    </trim>
  </insert>
    <update id="updateByUserId" parameterType="PmsPInformation">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    update pms_pinformation
    <set>
      <if test="userId != null">
        USER_ID = #{userId,jdbcType=CHAR},
      </if>
      <if test="name != null">
        NAME = #{name,jdbcType=NVARCHAR},
      </if>
      <if test="sex != null">
        SEX = #{sex,jdbcType=NVARCHAR},
      </if>
      <if test="nation != null">
        NATION = #{nation,jdbcType=NVARCHAR},
      </if>
      <if test="originplace != null">
        ORIGINPLACE = #{originplace,jdbcType=NVARCHAR},
      </if>
      <if test="politicalid != null">
        POLITICALID = #{politicalid,jdbcType=NVARCHAR},
      </if>
      <if test="joinpartyday != null">
        JOINPARTYDAY = #{joinpartyday,jdbcType=TIMESTAMP},
      </if>
      <if test="joinleagueday != null">
        JOINLEAGUEDAY = #{joinleagueday,jdbcType=TIMESTAMP},
      </if>
      <if test="maritalstatus != null">
        MARITALSTATUS = #{maritalstatus,jdbcType=NVARCHAR},
      </if>
      <if test="degree != null">
        DEGREE = #{degree,jdbcType=NVARCHAR},
      </if>
      <if test="major != null">
        MAJOR = #{major,jdbcType=NVARCHAR},
      </if>
      <if test="school != null">
        SCHOOL = #{school,jdbcType=NVARCHAR},
      </if>
      <if test="hukou != null">
        HUKOU = #{hukou,jdbcType=NVARCHAR},
      </if>
      <if test="idnumber != null">
        IDNUMBER = #{idnumber,jdbcType=CHAR},
      </if>
      <if test="telephone != null">
        TELEPHONE = #{telephone,jdbcType=NVARCHAR},
      </if>
      <if test="creatime != null">
        CREATIME = #{creatime,jdbcType=TIMESTAMP},
      </if>
      <if test="refreshtime != null">
        REFRESHTIME = #{refreshtime,jdbcType=TIMESTAMP},
      </if>
      <if test="hired != null">
        HIRED = #{hired,jdbcType=BIT},
      </if>
      <if test="ppost != null">
        PPOST = #{ppost,jdbcType=NVARCHAR},
      </if>
      <if test="ptitle != null">
        PTITLE = #{ptitle,jdbcType=NVARCHAR},
      </if>
      <if test="photopath != null">
        PHOTOPATH = #{photopath,jdbcType=NVARCHAR},
      </if>
    </set>
    where USER_ID = #{userId,jdbcType=CHAR}
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="PmsPInformation">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    update pms_pinformation
    <set>
      <if test="userId != null">
        USER_ID = #{userId,jdbcType=CHAR},
      </if>
      <if test="name != null">
        NAME = #{name,jdbcType=NVARCHAR},
      </if>
      <if test="sex != null">
        SEX = #{sex,jdbcType=NVARCHAR},
      </if>
      <if test="nation != null">
        NATION = #{nation,jdbcType=NVARCHAR},
      </if>
      <if test="originplace != null">
        ORIGINPLACE = #{originplace,jdbcType=NVARCHAR},
      </if>
      <if test="politicalid != null">
        POLITICALID = #{politicalid,jdbcType=NVARCHAR},
      </if>
      <if test="joinpartyday != null">
        JOINPARTYDAY = #{joinpartyday,jdbcType=TIMESTAMP},
      </if>
      <if test="joinleagueday != null">
        JOINLEAGUEDAY = #{joinleagueday,jdbcType=TIMESTAMP},
      </if>
      <if test="maritalstatus != null">
        MARITALSTATUS = #{maritalstatus,jdbcType=NVARCHAR},
      </if>
      <if test="degree != null">
        DEGREE = #{degree,jdbcType=NVARCHAR},
      </if>
      <if test="major != null">
        MAJOR = #{major,jdbcType=NVARCHAR},
      </if>
      <if test="school != null">
        SCHOOL = #{school,jdbcType=NVARCHAR},
      </if>
      <if test="hukou != null">
        HUKOU = #{hukou,jdbcType=NVARCHAR},
      </if>
      <if test="idnumber != null">
        IDNUMBER = #{idnumber,jdbcType=CHAR},
      </if>
      <if test="telephone != null">
        TELEPHONE = #{telephone,jdbcType=NVARCHAR},
      </if>
      <if test="creatime != null">
        CREATIME = #{creatime,jdbcType=TIMESTAMP},
      </if>
      <if test="refreshtime != null">
        REFRESHTIME = #{refreshtime,jdbcType=TIMESTAMP},
      </if>
      <if test="hired != null">
        HIRED = #{hired,jdbcType=BIT},
      </if>
      <if test="ppost != null">
        PPOST = #{ppost,jdbcType=NVARCHAR},
      </if>
      <if test="ptitle != null">
        PTITLE = #{ptitle,jdbcType=NVARCHAR},
      </if>
      <if test="photopath != null">
        PHOTOPATH = #{photopath,jdbcType=NVARCHAR},
      </if>
    </set>
    where P_ID = #{pId,jdbcType=CHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="PmsPInformation">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 31 16:05:40 CST 2017.
    -->
    update pms_pinformation
    set USER_ID = #{userId,jdbcType=CHAR},
      NAME = #{name,jdbcType=NVARCHAR},
      SEX = #{sex,jdbcType=NVARCHAR},
      NATION = #{nation,jdbcType=NVARCHAR},
      ORIGINPLACE = #{originplace,jdbcType=NVARCHAR},
      POLITICALID = #{politicalid,jdbcType=NVARCHAR},
      JOINPARTYDAY = #{joinpartyday,jdbcType=TIMESTAMP},
      JOINLEAGUEDAY = #{joinleagueday,jdbcType=TIMESTAMP},
      MARITALSTATUS = #{maritalstatus,jdbcType=NVARCHAR},
      DEGREE = #{degree,jdbcType=NVARCHAR},
      MAJOR = #{major,jdbcType=NVARCHAR},
      SCHOOL = #{school,jdbcType=NVARCHAR},
      HUKOU = #{hukou,jdbcType=NVARCHAR},
      IDNUMBER = #{idnumber,jdbcType=CHAR},
      TELEPHONE = #{telephone,jdbcType=NVARCHAR},
      CREATIME = #{creatime,jdbcType=TIMESTAMP},
      REFRESHTIME = #{refreshtime,jdbcType=TIMESTAMP},
      HIRED = #{hired,jdbcType=BIT},
      PPOST = #{ppost,jdbcType=NVARCHAR},
      PTITLE = #{ptitle,jdbcType=NVARCHAR}
    where P_ID = #{pId,jdbcType=CHAR}
  </update>
</mapper>