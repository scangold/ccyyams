<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProjectMapper">
	<resultMap id="BaseResultMap" type="com.fh.entity.amsmodel.Project">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		<id column="PRJ_ID" jdbcType="INTEGER" property="prjId" />
		<result column="COVERAGE_ID" jdbcType="INTEGER" property="coverageId" />
		<result column="PRJTYPE" jdbcType="NVARCHAR" property="prjtype" />
		<result column="PRJ_NAME" jdbcType="NVARCHAR" property="prjName" />
		<result column="PRJ_ORIGIN" jdbcType="NVARCHAR" property="prjOrigin" />
		<result column="PRJ_LEADER" jdbcType="NVARCHAR" property="prjLeader" />
		<result column="PRJ_DEPART" jdbcType="NVARCHAR" property="prjDepart" />
		<result column="PRJ_STRATTIME" jdbcType="TIMESTAMP" property="prjStrattime" />
		<result column="PRJ_ENDTIME" jdbcType="TIMESTAMP" property="prjEndtime" />
		<result column="PRJ_PROGRESS" jdbcType="NVARCHAR" property="prjProgress" />
		<result column="PRJ_REMARK" jdbcType="NVARCHAR" property="prjRemark" />
		<result column="USER_ID" jdbcType="CHAR" property="userId" />
		<result column="YEAR" jdbcType="NVARCHAR" property="year" />
		<result column="RECORD_LIMIT" jdbcType="NVARCHAR" property="recordLimit" />
		<result column="SECURITY_CLASS" jdbcType="NVARCHAR" property="securityClass" />
		<result column="PRO_NUM" jdbcType="NVARCHAR" property="proNum" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		PRJ_ID, COVERAGE_ID, PRJTYPE, PRJ_NAME, PRJ_ORIGIN, PRJ_LEADER,
		PRJ_DEPART, PRJ_STRATTIME,
		PRJ_ENDTIME, PRJ_PROGRESS, PRJ_REMARK,
		USER_ID, YEAR, RECORD_LIMIT,
		SECURITY_CLASS,
		PRO_NUM
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		select
		<include refid="Base_Column_List" />
		from ams_project
		where PRJ_ID = #{prjId,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		delete from ams_project
		where PRJ_ID = #{prjId,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.fh.entity.amsmodel.Project">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		insert into ams_project (PRJ_ID, COVERAGE_ID, PRJTYPE,
		PRJ_NAME,
		PRJ_ORIGIN, PRJ_LEADER,
		PRJ_DEPART, PRJ_STRATTIME, PRJ_ENDTIME,
		PRJ_PROGRESS, PRJ_REMARK, USER_ID,
		YEAR, RECORD_LIMIT, SECURITY_CLASS,
		PRO_NUM)
		values (#{prjId,jdbcType=INTEGER},
		#{coverageId,jdbcType=INTEGER},
		#{prjtype,jdbcType=NVARCHAR},
		#{prjName,jdbcType=NVARCHAR}, #{prjOrigin,jdbcType=NVARCHAR},
		#{prjLeader,jdbcType=NVARCHAR},
		#{prjDepart,jdbcType=NVARCHAR},
		#{prjStrattime,jdbcType=TIMESTAMP},
		#{prjEndtime,jdbcType=TIMESTAMP},
		#{prjProgress,jdbcType=NVARCHAR}, #{prjRemark,jdbcType=NVARCHAR},
		#{userId,jdbcType=CHAR},
		#{year,jdbcType=NVARCHAR},
		#{recordLimit,jdbcType=NVARCHAR},
		#{securityClass,jdbcType=NVARCHAR},
		#{proNum,jdbcType=NVARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.fh.entity.amsmodel.Project">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		insert into ams_project
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="prjId != null">
				PRJ_ID,
			</if>
			<if test="coverageId != null">
				COVERAGE_ID,
			</if>
			<if test="prjtype != null">
				PRJTYPE,
			</if>
			<if test="prjName != null">
				PRJ_NAME,
			</if>
			<if test="prjOrigin != null">
				PRJ_ORIGIN,
			</if>
			<if test="prjLeader != null">
				PRJ_LEADER,
			</if>
			<if test="prjDepart != null">
				PRJ_DEPART,
			</if>
			<if test="prjStrattime != null">
				PRJ_STRATTIME,
			</if>
			<if test="prjEndtime != null">
				PRJ_ENDTIME,
			</if>
			<if test="prjProgress != null">
				PRJ_PROGRESS,
			</if>
			<if test="prjRemark != null">
				PRJ_REMARK,
			</if>
			<if test="userId != null">
				USER_ID,
			</if>
			<if test="year != null">
				YEAR,
			</if>
			<if test="recordLimit != null">
				RECORD_LIMIT,
			</if>
			<if test="securityClass != null">
				SECURITY_CLASS,
			</if>
			<if test="proNum != null">
				PRO_NUM,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="prjId != null">
				#{prjId,jdbcType=INTEGER},
			</if>
			<if test="coverageId != null">
				#{coverageId,jdbcType=INTEGER},
			</if>
			<if test="prjtype != null">
				#{prjtype,jdbcType=NVARCHAR},
			</if>
			<if test="prjName != null">
				#{prjName,jdbcType=NVARCHAR},
			</if>
			<if test="prjOrigin != null">
				#{prjOrigin,jdbcType=NVARCHAR},
			</if>
			<if test="prjLeader != null">
				#{prjLeader,jdbcType=NVARCHAR},
			</if>
			<if test="prjDepart != null">
				#{prjDepart,jdbcType=NVARCHAR},
			</if>
			<if test="prjStrattime != null">
				#{prjStrattime,jdbcType=TIMESTAMP},
			</if>
			<if test="prjEndtime != null">
				#{prjEndtime,jdbcType=TIMESTAMP},
			</if>
			<if test="prjProgress != null">
				#{prjProgress,jdbcType=NVARCHAR},
			</if>
			<if test="prjRemark != null">
				#{prjRemark,jdbcType=NVARCHAR},
			</if>
			<if test="userId != null">
				#{userId,jdbcType=CHAR},
			</if>
			<if test="year != null">
				#{year,jdbcType=NVARCHAR},
			</if>
			<if test="recordLimit != null">
				#{recordLimit,jdbcType=NVARCHAR},
			</if>
			<if test="securityClass != null">
				#{securityClass,jdbcType=NVARCHAR},
			</if>
			<if test="proNum != null">
				#{proNum,jdbcType=NVARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.fh.entity.amsmodel.Project">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		update ams_project
		<set>
			<if test="coverageId != null">
				COVERAGE_ID = #{coverageId,jdbcType=INTEGER},
			</if>
			<if test="prjtype != null">
				PRJTYPE = #{prjtype,jdbcType=NVARCHAR},
			</if>
			<if test="prjName != null">
				PRJ_NAME = #{prjName,jdbcType=NVARCHAR},
			</if>
			<if test="prjOrigin != null">
				PRJ_ORIGIN = #{prjOrigin,jdbcType=NVARCHAR},
			</if>
			<if test="prjLeader != null">
				PRJ_LEADER = #{prjLeader,jdbcType=NVARCHAR},
			</if>
			<if test="prjDepart != null">
				PRJ_DEPART = #{prjDepart,jdbcType=NVARCHAR},
			</if>
			<if test="prjStrattime != null">
				PRJ_STRATTIME = #{prjStrattime,jdbcType=TIMESTAMP},
			</if>
			<if test="prjEndtime != null">
				PRJ_ENDTIME = #{prjEndtime,jdbcType=TIMESTAMP},
			</if>
			<if test="prjProgress != null">
				PRJ_PROGRESS = #{prjProgress,jdbcType=NVARCHAR},
			</if>
			<if test="prjRemark != null">
				PRJ_REMARK = #{prjRemark,jdbcType=NVARCHAR},
			</if>
			<if test="userId != null">
				USER_ID = #{userId,jdbcType=CHAR},
			</if>
			<if test="year != null">
				YEAR = #{year,jdbcType=NVARCHAR},
			</if>
			<if test="recordLimit != null">
				RECORD_LIMIT = #{recordLimit,jdbcType=NVARCHAR},
			</if>
			<if test="securityClass != null">
				SECURITY_CLASS = #{securityClass,jdbcType=NVARCHAR},
			</if>
			<if test="proNum != null">
				PRO_NUM = #{proNum,jdbcType=NVARCHAR},
			</if>
		</set>
		where PRJ_ID = #{prjId,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.fh.entity.amsmodel.Project">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 03 
			15:37:35 CST 2016. -->
		update ams_project
		set COVERAGE_ID = #{coverageId,jdbcType=INTEGER},
		PRJTYPE = #{prjtype,jdbcType=NVARCHAR},
		PRJ_NAME =
		#{prjName,jdbcType=NVARCHAR},
		PRJ_ORIGIN =
		#{prjOrigin,jdbcType=NVARCHAR},
		PRJ_LEADER =
		#{prjLeader,jdbcType=NVARCHAR},
		PRJ_DEPART =
		#{prjDepart,jdbcType=NVARCHAR},
		PRJ_STRATTIME =
		#{prjStrattime,jdbcType=TIMESTAMP},
		PRJ_ENDTIME =
		#{prjEndtime,jdbcType=TIMESTAMP},
		PRJ_PROGRESS =
		#{prjProgress,jdbcType=NVARCHAR},
		PRJ_REMARK =
		#{prjRemark,jdbcType=NVARCHAR},
		USER_ID = #{userId,jdbcType=CHAR},
		YEAR
		= #{year,jdbcType=NVARCHAR},
		RECORD_LIMIT =
		#{recordLimit,jdbcType=NVARCHAR},
		SECURITY_CLASS =
		#{securityClass,jdbcType=NVARCHAR},
		PRO_NUM =
		#{proNum,jdbcType=NVARCHAR}
		where PRJ_ID = #{prjId,jdbcType=INTEGER}
	</update>


	<!-- 20160512 11:53:21kioor -->

	<sql id="tableName">
		ams_project
	</sql>

	<select id="listAll" parameterType="com.fh.util.PageData"
		resultType="pd">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="tableName" />
	</select>


	<select id="datalistPage" parameterType="page" resultType="pd">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="tableName" />
		where 1=1
		<if test="pd.keywords!= null and pd.keywords != ''"><!-- 关键词检索 -->
			and
			(
			PRJ_NAME LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			PRJ_ID LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			YEAR LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			PRJ_ORIGIN LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			or
			PRJTYPE LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
			)

		</if>
	</select>


	<delete flushCache="false" id="delete" parameterType="pd">
		delete from
		<include refid="tableName" />
		where
		PRJ_ID = #{PRJ_ID}
	</delete>

	<insert id="save" parameterType="pd">
		insert into
		<include refid="tableName" />
		(
		COVERAGE_ID, PRJTYPE, PRJ_NAME, PRJ_ORIGIN, PRJ_LEADER,
		PRJ_DEPART, PRJ_STRATTIME,
		PRJ_ENDTIME, PRJ_PROGRESS, PRJ_REMARK,
		USER_ID, YEAR, RECORD_LIMIT,
		SECURITY_CLASS,PRO_NUM
		
		) values (
		#{COVERAGE_ID},#{PRJTYPE},#{PRJ_NAME},#{PRJ_ORIGIN},#{PRJ_LEADER},
		#{PRJ_DEPART},#{PRJ_STRATTIME},
		#{PRJ_ENDTIME},#{PRJ_PROGRESS},#{PRJ_REMARK},
		#{USER_ID},#{YEAR},#{RECORD_LIMIT},
		#{SECURITY_CLASS},#{PRO_NUM}
		
		)

	</insert>
	
	<insert id="saveproject" keyProperty="prjId" parameterType="Project"
		useGeneratedKeys="true">
		insert into
		<include refid="tableName" />
		(
		<include refid="ValueTemp" />
		) values (
		<include refid="FieldValueTemp2" />
		)

	</insert>

	<sql id="ValueTemp">
		PRJTYPE,
		PRJ_NAME,
		PRJ_ORIGIN,
		PRJ_LEADER,
		PRJ_DEPART,
		USER_ID,
		YEAR,
		RECORD_LIMIT,
		SECURITY_CLASS
	</sql>

	<sql id="FieldValueTemp">
		#{PRJTYPE},
		#{PRJ_NAME},
		#{PRJ_ORIGIN},
		#{PRJ_LEADER},
		#{PRJ_DEPART},
		#{USER_ID},
		#{YEAR},
		#{RECORD_LIMIT},
		#{SECURITY_CLASS}
	</sql>


	<sql id="FieldValueTemp2">
		#{prjtype},
		#{prjName},
		#{prjOrigin},
		#{prjLeader},
		#{prjDepart},
		#{userId},
		#{year},
		#{recordLimit},
		#{securityClass}
	</sql>

	<!-- 通过名称NAME获取数据 -->
	<select id="findPDByName" parameterType="java.lang.String" resultType="pd">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="tableName" />
		where
		ams_project.PRJ_NAME = #{prjname}
	</select>
	<!-- 获取总数 -->
	<select id="getProjectCount" resultType="pd">
		select
		count(1) as projectCount
		from
		<include refid="tableName" />
	</select>
	<select id="getProjectFilelist" resultType="pd">
		select
		apr.PRJ_ID,count(1) as counts ,apr.PRJ_NAME from ( select
		ap.PRJ_ID,ap.PRJ_NAME,ar.RC_ID from ams_project ap join ams_receive ar
		on ar.PRJ_ID=ap.PRJ_ID) apr join ams_file af on af.RC_ID=apr.RC_ID
		group by apr.PRJ_NAME,apr.PRJ_ID

	</select>
	<select id="getproTotallistPage" parameterType="page" resultType="pd">

		select afrc.*,ap.prj_name ,ap.prj_strattime from
		ams_project ap join (
		select ar.prj_id,af.unit,sum(counts) as
		num,sum(sums) as size from (
		select rc_id,count(1) as
		counts,sum(convert(float,volume)) as
		sums,unit from ams_file af group
		by rc_id,unit ) af
		join ams_receive ar on ar.rc_id=af.rc_id where 1=1
		group by
		ar.prj_id,af.unit ) afrc on ap.prj_id=afrc.prj_id
	</select>
	<select id="getProjiecNameAndId" parameterType="java.lang.String"  resultType="pd"   >
		select
		PRJ_ID as prjId, PRJ_NAME as prjName
		from ams_project
		
		 where 
		 PRJ_NAME like 
		  CONCAT('%',#{prjName},'%')

		
	</select>

		<!-- 修改 -->
	<update id="edit" parameterType="pd">
		update
		<include refid="tableName"></include>
		set
		PRJTYPE = #{PRJTYPE},
		PRJ_NAME = #{PRJ_NAME},
		PRJ_ORIGIN = #{PRJ_ORIGIN},
		PRJ_LEADER = #{PRJ_LEADER},
		PRJ_DEPART = #{PRJ_DEPART},
		USER_ID = #{USER_ID},
		YEAR = #{YEAR},
		RECORD_LIMIT = #{RECORD_LIMIT},
		SECURITY_CLASS = #{SECURITY_CLASS}
		
		where
		PRJ_ID = #{PRJ_ID}
	</update>
	
	<!-- 通过PRJ_ID获取数据 -->
	<select id="findById" parameterType="pd" resultType="pd">
		select
		
		PRJ_ID
		PRJTYPE,
		PRJ_NAME,
		PRJ_ORIGIN,
		PRJ_LEADER,
		PRJ_DEPART,
		USER_ID,
		YEAR,
		RECORD_LIMIT,
		SECURITY_CLASS

		from
		<include refid="tableName"></include>
		where
		PRJ_ID = #{PRJ_ID}
	</select>

</mapper>